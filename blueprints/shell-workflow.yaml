---
variables:
  - name: var1
    type: timestamp
    value: '2015-10-11 22:33:44'
    format: YYYY-MM-DD HH24:MI:SS
rootdoc: "/tmp/workflow1"
type: workflow
name: workflow1
displayName: BTC/USD average exchange rate
description: Retrieves BTC/USD exchange rate from 3 different exchanges, calculates
  an average and puts the latter into db
input:
  httpClientTimeout: 30
start:
  parallelism: 10
  multithread: true
  subscribers:
    - shell701
actions:

  - name: shell701
    type: SHELL
    displayName: Print average rate shell701
    description: Prints average BTC/USD rate in the canonical form
    args:
      shellScript: ls -ltr /tmp
    output:           # shell's stdout will be copied to next actions
    next:
      parallelism: 1
      multithread: false
      subscribers:
        - shell702

  - name: shell702
    type: SHELL
    displayName: Print average rate shell701
    description: Prints average BTC/USD rate in the canonical form
    args:
      shellScript: echo "test 2"
      sshHost: scripthost.noetl.io
      sshPort: '22'
      sshUser: scripter
      sshIdentityFile: "/home/noetl/ssh-keys/scripthost.pem"
      shellScript: "/usr/local/bin/calc-average"
      scriptParams: "${input}"
    output:           # shell's stdout will be copied to next actions
    next:
      parallelism: 1
      multithread: false
      subscribers:

  - name: websvc101
    type: webservice
    args:
      httpClientTimeout: "${inputData.httpClientTimeout}"
      httpMethod: GET
      url: https://cex.io/api/last_price/BTC/USD
    displayName: CEX.io websvc101
    description: Request BTC/USD rate from CEX.io
    output: "${responseBody}"
    next:
      parallelism: '1'
      multithread: 'false'
      subscribers:
      - websvc102
